<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>api/index.html6</title>
</head>

<body>
    <div id="show"></div>
    <script>
        function makePage(aryData) {
            //[{id: ??, fist_name:??,last_name:?? , email:??}]
            // -> table 형식.
            // table > thead, tbody > tr > th,td
            let table = document.createElement('table');
            table.setAttribute('border', '1');

            let thd = document.createElement('thead');
            let tr = document.createElement('tr');

            thd.appendChild(tr);

            let tbd = document.createElement('tbody');
            let ul = document.createElement('ul');
            aryData.forEach(function (item, ind) {
                let li = document.createElement('li');
                let text = document.createTextNode(`${item.id} - ${item.first_name} - ${item.last_name},
                                                ${item.email},${item.gender} `);
                li.appendChild(text);
                ul.appendChild(li);
                tbd.appendChild(ul);
                table.appendChild(tbd);
            })
            console.log(ul);
            document.getElementsByTagName('body')[0].appendChild(ul);
        }

        //보여줄 항목 정의
        const fields = ['id', 'centerName', 'address', 'phoneNumber', 'sido', 'sigungu'];

        function showCenterList(data) {
            // 전체카운트: data.currentCount : 284
            // 현제페이지: data.page : 1
            // 전체데이터: data.data : 284건의 접좁센터 정보
            let tbl = document.createElement('table');
            tbl.setAttribute('border', '1');
            tbl.setAttribute('id', 'tbl');
            let thead = document.createElement('thead');
            let tbody = document.createElement('tbody');
            // table의 하위요소로 thead,tbody 추가
            tbl.append(thead, tbody);
            //thead작성
            let tr = document.createElement('tr');
            fields.forEach(function (field) {
                let td = document.createElement('th');
                let text = document.createTextNode(field.toUpperCase());
                td.append(text);
                tr.append(td);
            });
            thead.appendChild(tr);
            //tbody 작성
            data.data.forEach(function (item) {
                let tr = document.createElement('tr');
                fields.forEach(function (field) {
                    let td = document.createElement('td');
                    let text = document.createTextNode(item[field]);
                    td.append(text);
                    tr.append(td);
                });
                tbody.appendChild(tr);
            });

            document.getElementById('show').append(tbl);
        }
        // Asynchoronous Javascript And Xml (ajax)
        let url =
            `https://api.odcloud.kr/api/15077586/v1/centers?page=1&perPage=284&returnType=JSON&serviceKey=zBSuJ3QYBy2wkk8rUEC3pNlbBCaFf2zzwjidD%2BsYXgjcNurzwKaBmyVITSIhRIvzBhQGRt%2BEblwHmq4VLoHyOg%3D%3D`;
        let xhtp = new XMLHttpRequest();
        xhtp.onreadystatechange = function () {
            if (xhtp.readyState == 4 && xhtp.status == 200) {
                console.log('readyState: ' + xhtp.readyState);
                console.log('status: ' + xhtp.status);
                let data = JSON.parse(xhtp.responseText);
                console.log(data);

                //makePage(data);
                showCenterList(data);
            }
        }
        xhtp.open('get', url);
        xhtp.send();
    </script>

</body>

</html>